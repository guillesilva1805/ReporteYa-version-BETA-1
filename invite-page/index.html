<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Crear o restablecer contraseña - ReporteYa</title>
  <script src="https://esm.sh/@supabase/supabase-js@2"></script>
  <style>
    :root { --bg:#fff; --fg:#111; --primary:#1565C0; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--fg); font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
    .wrap { max-width: 480px; margin: 40px auto; padding: 0 16px; }
    h1 { margin: 0 0 8px; }
    p.help { margin: 0 0 16px; color:#444; }
    .field { margin: 12px 0; }
    input {
      width: 100%; padding: 12px 14px; font-size: 16px;
      border: 2px solid #90A4AE; border-radius: 10px; outline: none;
      background: #D6E4FF; color:#111;
    }
    input:focus { border-color:#3B82F6; }
    button {
      width: 100%; padding: 12px 14px; margin-top: 8px;
      border: 0; border-radius: 999px; background: var(--primary); color:#fff; font-size:16px; cursor:pointer;
    }
    .msg { min-height: 24px; margin-top: 8px; font-size:14px; }
    .ok { color: #2E7D32; } .err { color: #D32F2F; }
    .footer { margin-top:24px; font-size:12px; color:#666; }
  </style>
  <meta name="robots" content="noindex" />
  <meta name="referrer" content="no-referrer" />
  <link rel="icon" href="data:," />
  <!-- Nota: Esta página debe publicarse en Netlify/Vercel y usarse como redirect de la invitación -->
  <!-- Config pública (ANON) de Supabase -->
  <script>
    window.__SUPABASE_URL__ = "https://uppdkjfjxtjnukftgwhz.supabase.co";
    window.__SUPABASE_ANON__ = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVwcGRramZqeHRqbnVrZnRnd2h6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc3MDE3NjMsImV4cCI6MjA2MzI3Nzc2M30._bPFFm4NqghiVPmytaGkiD40QFc1Ct-oIQx1gOK0g74";
  </script>
</head>
<body>
  <div class="wrap">
    <h1>Crear o restablecer contraseña</h1>
    <p class="help">Abre este enlace desde el correo de invitación o recuperación. Luego define tu nueva contraseña.</p>

    <div class="field"><input id="pass1" type="password" placeholder="Nueva contraseña" autocomplete="new-password" /></div>
    <div class="field"><input id="pass2" type="password" placeholder="Repite la contraseña" autocomplete="new-password" /></div>
    <button id="btn">Guardar contraseña</button>
    <div id="msg" class="msg"></div>

    <div class="footer">Si ves un error, vuelve al correo y abre el enlace otra vez.</div>
  </div>

  <script>
    let supabase;
    const q = (s) => document.querySelector(s);
    const show = (t, ok=false) => { const el=q('#msg'); el.textContent=t; el.className='msg '+(ok?'ok':'err'); };

    async function ensureInviteSession() {
      const { data: { session }, error } = await supabase.auth.getSession();
      if (error || !session) { show('No hay sesión de invitación activa. Abre el enlace del correo nuevamente.'); return false; }
      return true;
    }

    window.addEventListener('load', async () => {
      supabase = window.supabase.createClient(window.__SUPABASE_URL__, window.__SUPABASE_ANON__);
      await ensureInviteSession();
    });

    q('#btn').onclick = async () => {
      if (!(await ensureInviteSession())) return;
      const p1 = q('#pass1').value.trim();
      const p2 = q('#pass2').value.trim();
      if (!p1 || !p2 || p1 !== p2) { show('Las contraseñas no coinciden.'); return; }
      if (p1.length < 12) { show('Usa al menos 12 caracteres.'); return; }
      const { error } = await supabase.auth.updateUser({ password: p1 });
      if (error) { show('No se pudo guardar. Intenta otra vez.'); return; }
      show('Contraseña actualizada. Ya puedes iniciar sesión en la app.', true);
    };
  </script>
</body>
</html>


